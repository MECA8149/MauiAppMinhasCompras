<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiApp1.Views.ListaProduto"
             Title="Lista de Produtos"
             BackgroundColor="{DynamicResource Gray100}">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Somar" Clicked="ToolbarItem_Clicked_1" Priority="0" Order="Primary"/>
        <ToolbarItem Text="Adicionar" Clicked="ToolbarItem_Clicked" Priority="1" Order="Primary"/>
        <ToolbarItem Text="Relatório" Clicked="ToolbarItem_Relatorio_Clicked" Priority="2" Order="Primary"/>
    </ContentPage.ToolbarItems>

    <ScrollView>
        <!-- ADICIONE ESTE SCROLLVIEW -->
        <StackLayout Padding="15" Spacing="15">

            <!-- Filtro por Categoria -->
            <Frame HasShadow="True"
                   CornerRadius="15"
                   Padding="5"
                   BackgroundColor="White">
                <Picker x:Name="categoriaFilterPicker"
                        Title="📂 Filtrar por Categoria"
                        SelectedIndexChanged="CategoriaFilterPicker_SelectedIndexChanged"
                        BackgroundColor="Transparent"
                        FontSize="16"/>
            </Frame>

            <!-- Barra de busca -->
            <Frame HasShadow="True"
                   CornerRadius="15"
                   Padding="5"
                   BackgroundColor="White">
                <SearchBar x:Name="txt_search" 
                           Placeholder="🔍 Buscar produto..."
                           TextChanged="txt_search_TextChanged"
                           BackgroundColor="Transparent"
                           FontSize="16"/>
            </Frame>

            <!-- Lista de produtos -->
            <Frame HasShadow="True"
                   CornerRadius="10"
                   Padding="0"
                   BackgroundColor="{StaticResource Gray400}">

                <ListView x:Name="lst_produtos"
                          IsPullToRefreshEnabled="True"
                          Refreshing="lst_produtos_Refreshing"
                          ItemSelected="lst_produtos_ItemSelected"
                          SeparatorVisibility="None"
                          HasUnevenRows="True"
                          HeightRequest="500">
                    <!-- DEFINA UMA ALTURA FIXA OU REMOVA O FRAME -->

                    <!-- Cabeçalho -->
                    <ListView.Header>
                        <Grid ColumnDefinitions="1*,3*,2*,1*,2*"
                              Padding="10"
                              BackgroundColor="{DynamicResource Gray200}">
                            <Label Grid.Column="0" Text="ID" FontAttributes="Bold" HorizontalOptions="Center"/>
                            <Label Grid.Column="1" Text="Descrição" FontAttributes="Bold" HorizontalOptions="Center"/>
                            <Label Grid.Column="2" Text="Preço" FontAttributes="Bold" HorizontalOptions="Center"/>
                            <Label Grid.Column="3" Text="Qtd" FontAttributes="Bold" HorizontalOptions="Center"/>
                            <Label Grid.Column="4" Text="Total" FontAttributes="Bold" HorizontalOptions="Center"/>
                        </Grid>
                    </ListView.Header>

                    <!-- Itens - APENAS UM ItemTemplate -->
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <ViewCell>
                                <ViewCell.ContextActions>
                                    <MenuItem Text="Excluir" 
                                              Clicked="MenuItem_Clicked"
                                              IsDestructive="True"/>
                                </ViewCell.ContextActions>

                                <Frame HasShadow="False"
                                       CornerRadius="10"
                                       Padding="8"
                                       Margin="5"
                                       BackgroundColor="{DynamicResource Gray100}">
                                    <Grid ColumnDefinitions="1*,3*,2*,1*,2*" Padding="8" ColumnSpacing="10">
                                        <Label Grid.Column="0" Text="{Binding Id}" HorizontalOptions="Center" VerticalOptions="Center"/>
                                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                                            <Label Text="{Binding Descricao}" HorizontalOptions="Center"/>
                                            <Label Text="{Binding Categoria}" 
                                                   FontSize="12" 
                                                   TextColor="Gray"
                                                   HorizontalOptions="Center"/>
                                        </VerticalStackLayout>
                                        <Label Grid.Column="2" Text="{Binding Preco, StringFormat='{}{0:c}'}" HorizontalOptions="Center" VerticalOptions="Center"/>
                                        <Label Grid.Column="3" Text="{Binding Quantidade}" HorizontalOptions="Center" VerticalOptions="Center"/>
                                        <Label Grid.Column="4" Text="{Binding Total, StringFormat='{}{0:c}'}" 
                                               FontAttributes="Bold"
                                               HorizontalOptions="Center" VerticalOptions="Center"/>
                                    </Grid>
                                </Frame>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Frame>
        </StackLayout>
    </ScrollView>
    <!-- FIM DO SCROLLVIEW -->
</ContentPage>